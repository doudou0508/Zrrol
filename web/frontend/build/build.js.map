{"version":3,"sources":["../../node_modules/browser-pack/_prelude.js","js/ajax.js","js/chart.js","js/main.js"],"names":[],"mappings":"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","file":"build.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// https://gist.github.com/Xeoncross/7663273\n\nmodule.exports.get = (url, callback, x) => {\n  try {\n    x = new(this.XMLHttpRequest || ActiveXObject)('MSXML2.XMLHTTP.3.0');\n    x.open('GET', url, 1);\n    x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    x.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n    x.onreadystatechange = function () {\n      x.readyState > 3 && callback && callback(x.responseText, x);\n    };\n    x.send(data)\n  } catch (e) {\n    window.console && console.log(e);\n  }\n}\n\nmodule.exports.post = (url, callback, data, x) => {\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"POST\", url, true);\n  xhr.setRequestHeader(\"Content-type\", \"application/json\");\n  xhr.onreadystatechange = function () { \n      if (xhr.readyState == 4 && xhr.status == 200) {\n          var json = JSON.parse(xhr.responseText);\n          callback(json);\n      }\n  }\n  var data = JSON.stringify(data);\n  xhr.send(data);\n};\n\n\n// https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n// https://gist.github.com/jed/993585\n// https://gist.github.com/Fluidbyte/5082377\n// https://github.com/Xeoncross/kb_javascript_framework/blob/master/kB.js#L30\n// https://gist.github.com/iwek/5599777\n// http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#_id\n\n// @todo look into lengthComputable for xhr.upload browsers\n// http://stackoverflow.com/questions/11127654/why-is-progressevent-lengthcomputable-false\n// http://stackoverflow.com/questions/10956574/why-might-xmlhttprequest-progressevent-lengthcomputable-be-false\n// https://github.com/ForbesLindesay/ajax/blob/master/index.js","module.exports = function(data, trades) {\n\n    var margin = {top: 20, right: 20, bottom: 30, left: 50},\n            width = 960 - margin.left - margin.right,\n            height = 500 - margin.top - margin.bottom;\n\n    var dateFormat = d3.timeFormat(\"%d-%b-%y\"),\n        parseDate = d3.timeParse(\"%Y-%m-%dT%H:%M:%SZ\"),//\"%d-%b-%y\"),\n        valueFormat = d3.format(',.2f');\n\n    var x = techan.scale.financetime()\n            .range([0, width]);\n\n    var y = d3.scaleLinear()\n            .range([height, 0]);\n\n    var candlestick = techan.plot.candlestick()\n            .xScale(x)\n            .yScale(y);\n\n    var tradearrow = techan.plot.tradearrow()\n            .xScale(x)\n            .yScale(y)\n            .orient(function(d) { return d.action.startsWith(\"buy\") ? \"up\" : \"down\"; })\n            .on(\"mouseenter\", enter)\n            .on(\"mouseout\", out);\n\n    var xAxis = d3.axisBottom(x);\n\n    var yAxis = d3.axisLeft(y);\n\n    var svg = d3.select(\"body\").append(\"svg\")\n            .attr(\"width\", width + margin.left + margin.right)\n            .attr(\"height\", height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    var valueText = svg.append('text')\n            .style(\"text-anchor\", \"end\")\n            .attr(\"class\", \"coords\")\n            .attr(\"x\", width - 5)\n            .attr(\"y\", 15);\n\n    var accessor = candlestick.accessor();\n\n    data = data.map(function(d) {\n        return {\n            date: moment(d.start).toDate(),\n            open: +d.open,\n            high: +d.high,\n            low: +d.low,\n            close: +d.close,\n            volume: +d.volume\n        };\n    }).sort(function(a, b) { return d3.ascending(accessor.d(a), accessor.d(b)); });\n\n    // var trades = [\n    //     { date: data[67].date, type: \"buy\", price: data[67].low, quantity: 1000 },\n    //     { date: data[100].date, type: \"sell\", price: data[100].high, quantity: 200 },\n    //     { date: data[156].date, type: \"buy\", price: data[156].open, quantity: 500 },\n    //     { date: data[167].date, type: \"sell\", price: data[167].close, quantity: 300 },\n    //     { date: data[187].date, type: \"buy-pending\", price: data[187].low, quantity: 300 }\n    // ];\n\n    svg.append(\"g\")\n            .attr(\"class\", \"candlestick\");\n\n    svg.append(\"g\")\n            .attr(\"class\", \"tradearrow\");\n\n    svg.append(\"g\")\n            .attr(\"class\", \"x axis\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\");\n\n    svg.append(\"g\")\n            .attr(\"class\", \"y axis\")\n            .append(\"text\")\n            .attr(\"transform\", \"rotate(-90)\")\n            .attr(\"y\", 6)\n            .attr(\"dy\", \".71em\")\n            .style(\"text-anchor\", \"end\")\n            .text(\"Price (\" + $('#currency').val()  + \")\");\n\n    // Data to display initially\n    // draw(data.slice(0, data.length-20), trades.slice(0, trades.length-1));\n    draw(data, trades);\n    // Only want this button to be active if the data has loaded\n    // d3.select(\"button\").on(\"click\", function() { draw(data, trades); }).style(\"display\", \"inline\");\n\n    function draw(data, trades) {\n        trades = _.map(trades, function(t) {\n            t.date = moment(t.date).toDate();\n            t.type = t.action;\n            t.quantity = t.balance;\n            return t;\n        });\n        console.log(trades);\n\n        x.domain(data.map(candlestick.accessor().d));\n        y.domain(techan.scale.plot.ohlc(data, candlestick.accessor()).domain());\n\n        svg.selectAll(\"g.candlestick\").datum(data).call(candlestick);\n\n        svg.selectAll(\"g.tradearrow\").datum(trades).call(tradearrow);\n\n        svg.selectAll(\"g.x.axis\").call(xAxis);\n        svg.selectAll(\"g.y.axis\").call(yAxis);\n    }\n\n    function enter(d) {\n        valueText.style(\"display\", \"inline\");\n        refreshText(d);\n    }\n\n    function out() {\n        valueText.style(\"display\", \"none\");\n    }\n\n    function refreshText(d) {\n        valueText.text(\"Trade: \" + dateFormat(d.date) + \", \" + d.type + \", \" + valueFormat(d.price));\n    }\n\n};","var post = require('./ajax').post;\nvar chart = require('./chart');\n// todo!\n// var exchages = require('../../../exchanges');\n\nvar fmt = u => moment.unix(u).utc().format('YYYY-MM-DD HH:mm:ss');\n\nvar $backtest = document.getElementById('backtest');\n$backtest.onclick = () => {\n  $('svg').remove();\n\n  var request = {\n    watch: {\n      exchange: $('#exchange').val(),\n      currency: $('#currency').val(),\n      asset: $('#asset').val()\n    }\n  }\n\n  var handle = ranges => {\n    // var ranges = JSON.parse(data);\n    // if(_.size(ranges) === 1) {\n    //   daterange = _.first(ranges);\n    // }\n\n    var q = 'what range would you like?\\n';\n    _.each(ranges, (r, i) => {\n      q += 'OPTION ' + (i + 1) + '\\n';\n      q += '\\tfrom ' + fmt(r.from) + '\\n';\n      q += '\\tto ' + fmt(r.to) + '\\n';\n    });\n\n    var index = parseInt(prompt(q)) - 1;\n    \n    var daterange = {\n      from: fmt(ranges[index].from),\n      to: fmt(ranges[index].to)\n    }\n\n    var request = {\n      tradingAdvisor: {\n        enabled: true,\n        method: $('#strat').val(),\n        candleSize: +$('#candleSize').val(),\n        historySize: +$('#historySize').val(),\n        talib: {\n          enabled: $('#talib').val() === 'true',\n          version: '1.0.2'\n        }\n      },\n      watch: {\n        exchange: $('#exchange').val(),\n        currency: $('#currency').val(),\n        asset: $('#asset').val()\n      },\n      backtest: {\n        daterange: daterange\n      }\n    };\n\n    $('#log').text('running backtest');\n    console.log('backtesting...', request);\n    post('/api/backtest', function(data) {\n      console.log(data);\n      $('#log').text('done!');\n      chart(data.candles, data.trades);\n    }, request);\n\n  }\n\n  $('#log').text('checking available data.');\n  post('/api/scan', handle, request);\n}\n\n"]}